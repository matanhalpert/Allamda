{% extends "base.html" %}

{% block title %}School Analytics - Allamda{% endblock %}

{% block extra_head %}
<link href="{{ url_for('static', filename='css/components.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='css/dashboard.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='css/analytics.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}

<!-- Page Header Banner -->
<div class="welcome-banner">
    <div class="welcome-content">
        <div class="welcome-text">
            <h1 class="welcome-title">School Analytics Dashboard</h1>
            <p class="welcome-subtitle">
                {% if has_school %}
                    Comprehensive analytics and insights for {{ school.name }}
                {% else %}
                    No school assigned
                {% endif %}
            </p>
        </div>
        <div class="welcome-illustration">
            <i class="fas fa-chart-line"></i>
        </div>
    </div>
</div>

{% if not has_school %}
<!-- Main Dashboard Grid -->
<div class="dashboard-grid">
    <div class="dashboard-section" style="grid-column: span 12; animation-delay: 0.1s;">
        <div class="alert alert-warning" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <strong>No School Assigned:</strong> You are not currently assigned to any school. Please contact your administrator.
        </div>
        <div class="text-center mt-4">
            <a href="/" class="btn btn-primary">
                <i class="fas fa-home me-2"></i>Return to Dashboard
            </a>
        </div>
    </div>
</div>
{% else %}

<!-- Main Dashboard Grid -->
<div class="dashboard-grid">

    <!-- Quick Statistics Section -->
    <div class="dashboard-section stats-section" style="grid-column: span 9; animation-delay: 0.1s;">
        <div class="section-header">
            <h3><i class="fas fa-tachometer-alt me-2"></i>Key Metrics</h3>
        </div>
        <div class="stats-grid">
            <div class="stat-card stat-primary">
                <div class="stat-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-value">{{ analytics.total_students }}</div>
                    <div class="stat-label">Total Students</div>
                </div>
            </div>
            
            <div class="stat-card stat-success">
                <div class="stat-icon">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div class="stat-info">
                    {% if analytics.average_grade %}
                    <div class="stat-value">{{ analytics.average_grade }}</div>
                    {% else %}
                    <div class="stat-value text-muted" style="font-size: 1.5rem;">N/A</div>
                    {% endif %}
                    <div class="stat-label">Average Grade</div>
                </div>
            </div>
            
            <div class="stat-card stat-info">
                <div class="stat-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-info">
                    {% if analytics.attendance_rate %}
                    <div class="stat-value">{{ analytics.attendance_rate }}%</div>
                    {% else %}
                    <div class="stat-value text-muted" style="font-size: 1.5rem;">N/A</div>
                    {% endif %}
                    <div class="stat-label">Attendance Rate</div>
                </div>
            </div>
            
            <div class="stat-card stat-warning">
                <div class="stat-icon">
                    <i class="fas fa-book-open"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-value">{{ analytics.active_courses }}</div>
                    <div class="stat-label">Active Courses</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Time Period Filter Section -->
    <div class="dashboard-section" style="grid-column: span 3; animation-delay: 0.1s;">
        <div class="section-header">
            <h3><i class="fas fa-filter me-2"></i>Time Period</h3>
        </div>
        <div class="time-filter-container">
            <select class="form-select" id="periodSelect" onchange="updatePeriod()">
                <option value="30" {% if selected_period == '30' %}selected{% endif %}>Last 30 Days</option>
                <option value="90" {% if selected_period == '90' %}selected{% endif %}>Last Quarter</option>
                <option value="365" {% if selected_period == '365' %}selected{% endif %}>Last Year</option>
                <option value="all" {% if selected_period == 'all' %}selected{% endif %}>All Time</option>
            </select>
        </div>
    </div>

    <!-- Grade Trends Chart -->
    <div class="dashboard-section" style="grid-column: span 6; animation-delay: 0.3s;">
        <div class="chart-container">
            {{ charts.grade_trends | safe }}
        </div>
    </div>
    
    <!-- Attendance Trends Chart -->
    <div class="dashboard-section" style="grid-column: span 6; animation-delay: 0.3s;">
        <div class="chart-container">
            {{ charts.attendance_trends | safe }}
        </div>
    </div>

    <!-- Class Performance Chart -->
    <div class="dashboard-section" style="grid-column: span 6; animation-delay: 0.4s;">
        <div class="chart-container">
            {{ charts.class_performance | safe }}
        </div>
    </div>
    
    <!-- Top Students Chart -->
    <div class="dashboard-section" style="grid-column: span 6; animation-delay: 0.4s;">
        <div class="chart-container">
            {{ charts.top_students | safe }}
        </div>
    </div>

    <!-- School Information Section -->
    <div class="dashboard-section" style="grid-column: span 12; animation-delay: 0.5s;">
        <div class="section-header">
            <h3><i class="fas fa-school me-2"></i>School Information</h3>
        </div>
        
        <div class="school-info-grid">
            <div class="school-info-card">
                <div class="info-card-header">
                    <i class="fas fa-building"></i>
                    <span class="info-card-label">Institution</span>
                </div>
                <div class="info-card-content">
                    <div class="info-item">
                        <span class="info-key">Name:</span>
                        <span class="info-value">{{ school.name }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-key">School ID:</span>
                        <span class="info-value">{{ school.id }}</span>
                    </div>
                </div>
            </div>
            
            <div class="school-info-card">
                <div class="info-card-header">
                    <i class="fas fa-map-marker-alt"></i>
                    <span class="info-card-label">Location</span>
                </div>
                <div class="info-card-content">
                    <div class="info-item">
                        <span class="info-key">City:</span>
                        <span class="info-value">{{ school.city }}, {{ school.country }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-key">Address:</span>
                        <span class="info-value">{{ school.street }} {{ school.num }}</span>
                    </div>
                </div>
            </div>
            
            <div class="school-info-card">
                <div class="info-card-header">
                    <i class="fas fa-address-book"></i>
                    <span class="info-card-label">Contact</span>
                </div>
                <div class="info-card-content">
                    <div class="info-item">
                        <span class="info-key">Email:</span>
                        <span class="info-value">{{ school.email }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-key">Phone:</span>
                        <span class="info-value">{{ school.phone }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<div style="margin-bottom: 3rem;"></div>

<script>
function updatePeriod() {
    const period = document.getElementById('periodSelect').value;
    window.location.href = `{{ url_for('school_manager.school_analytics') }}?period=${period}`;
}
</script>

{% endif %}
{% endblock %}