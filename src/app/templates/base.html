<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Allamda{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/colors.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/base.css') }}" rel="stylesheet">
    {% block extra_head %}{% endblock %}
</head>
<body>
    {% if session.user %}
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
            <a class="navbar-brand" href="/">
                <img src="{{ url_for('static', filename='images/full_logo.png') }}" alt="Allamda" class="navbar-logo">
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">
                    <i class="fas fa-home me-1"></i> Home
                </a>
                {% if session.user.user_type == 'student' %}
                <a class="nav-link" href="/my_courses">
                    <i class="fas fa-book-open me-1"></i> My Courses
                </a>
                <a class="nav-link" href="/study">
                    <i class="fas fa-book-reader me-1"></i> Study
                </a>
                {% elif session.user.user_type == 'class manager' %}
                <a class="nav-link" href="/my_class">
                    <i class="fas fa-users me-1"></i> My Class
                </a>
                <a class="nav-link" href="/classroom">
                    <i class="fas fa-chalkboard-teacher me-1"></i> Classroom
                </a>
                {% elif session.user.user_type == 'parent' %}
                <a class="nav-link" href="/my_kids">
                    <i class="fas fa-user-group me-1"></i> My Kids
                </a>
                {% elif session.user.user_type == 'school manager' %}
                <a class="nav-link" href="/school_analytics">
                    <i class="fas fa-chart-line me-1"></i> Analytics
                </a>
                {% endif %}
                <a class="nav-link" href="/logout">
                    <i class="fas fa-sign-out-alt me-1"></i> Logout
                </a>
            </div>
        </div>
    </nav>
    {% endif %}
    
    <main class="container mt-5">
        <!-- Custom Message Container -->
        <div id="message-container"></div>
        
        {% block content %}{% endblock %}
    </main>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Custom message display system
        function showMessage(text, category) {
            const container = document.getElementById('message-container');
            const messageId = 'msg-' + Date.now();
            
            // Icon mapping
            const icons = {
                'success': 'fa-check-circle',
                'error': 'fa-exclamation-circle',
                'warning': 'fa-exclamation-triangle',
                'info': 'fa-info-circle'
            };
            
            // Create message element
            const messageDiv = document.createElement('div');
            messageDiv.id = messageId;
            messageDiv.className = `custom-message custom-message-${category}`;
            messageDiv.innerHTML = `
                <i class="fas ${icons[category] || 'fa-info-circle'}"></i>
                <span class="message-text">${text}</span>
                <button class="message-close" onclick="closeMessage('${messageId}')" aria-label="Close">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(messageDiv);
            
            // Trigger animation
            setTimeout(() => messageDiv.classList.add('show'), 10);
            
            // Auto dismiss after 5 seconds
            setTimeout(() => closeMessage(messageId), 5000);
        }
        
        function closeMessage(messageId) {
            const message = document.getElementById(messageId);
            if (message) {
                message.classList.remove('show');
                message.classList.add('hide');
                setTimeout(() => message.remove(), 300);
            }
        }
        
        // Display messages from server
        document.addEventListener('DOMContentLoaded', function() {
            const messages = {{ get_messages() | tojson }};
            if (messages && messages.length > 0) {
                messages.forEach((msg, index) => {
                    setTimeout(() => showMessage(msg.text, msg.category), index * 100);
                });
            }
        });
    </script>
    {% block extra_scripts %}{% endblock %}
</body>
</html>
